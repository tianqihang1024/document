











## 你都改造了那些方法？

-   `cancelAcquire`（取消锁）

    `AQS`的`cancelAcquire`只是针对非`head`节点，对于`AQS`来说，`head`节点是不可能被取消的，其并不参与`FIFO`列初始化，后续节点在初始化`FIFO`对列的时候，才会设置一个持有锁的线程的虚假节点`head`，这个时候`head`已经持有锁，并且在执行业务。如果被取消掉，其他线程就会抢占锁，会导致同时有两个线程参与临界资源的修改。这是不符合线程安全的，必须要避免的。而这个需求是允许`head`取消，所以对他进行了逻辑上的重写，以适应需求。

-   